angular.module("mwFormUtils",["mwFormUtils.responseUtils"]);
angular.module("mwFormUtils.responseUtils",[]).factory("mwFormResponseUtils",function(){var e={};return e.$getObjectByIdMap=function(e,t){var r={};return e?(e.forEach(function(e){var i=e;t&&(i=t(e)),r[e.id]=i}),r):r},e.$getOfferedAnswerByIdMap=function(t){return e.$getObjectByIdMap(t.offeredAnswers,function(e){return{id:e.id,value:e.value}})},e.$extractResponseForRadioOrCheckboxQuestion=function(t,r){var i=e.$getOfferedAnswerByIdMap(t),n={};return r.selectedAnswers?(n.selectedAnswers=[],r.selectedAnswers.forEach(function(e){n.selectedAnswers.push(i[e])})):r.selectedAnswer&&(n.selectedAnswer=i[r.selectedAnswer]),r.other&&(n.other=r.other),n},e.$extractResponseForPriorityQuestion=function(t,r){var i=[];if(!r.priorityList)return i;var n=e.$getObjectByIdMap(t.priorityList);return r.priorityList.forEach(function(e){var t=n[e.id];i.push({id:t.id,value:t.value,priority:e.priority})}),i},e.$extractResponseForDivisionQuestion=function(t,r){var i=[],n=e.$getObjectByIdMap(t.divisionList);return Object.getOwnPropertyNames(r).forEach(function(e){var t=r[e],o=n[e];o&&i.push({id:o.id,label:o.value,value:t})}),i},e.$extractResponseForGridQuestion=function(t,r){var i=[];if(!t.grid||!t.grid.rows)return i;var n=e.$getObjectByIdMap(t.grid.cols);return t.grid.rows.forEach(function(e){var t=r[e.id],o=null;t&&(o=n[t]);var s={row:{id:e.id,label:e.label},col:null};o&&(s.col={id:o.id,label:o.label}),i.push(s)}),i},e.extractResponse=function(t,r){return"text"==t.type||"textarea"==t.type?r.answer:"radio"==t.type||"checkbox"==t.type?e.$extractResponseForRadioOrCheckboxQuestion(t,r):"grid"==t.type?e.$extractResponseForGridQuestion(t,r):"priority"==t.type?e.$extractResponseForPriorityQuestion(t,r):"division"==t.type?e.$extractResponseForDivisionQuestion(t,r):null},e.mergeFormWithResponse=function(t,r){var i={};return angular.copy(t,i),i.pages.forEach(function(t){t.elements.forEach(function(t){var i=t.question;if(i){var n=r[i.id];n&&(i.response=e.extractResponse(i,n))}})}),i},e.getQuestionList=function(e,t){var r=[];return e.pages.forEach(function(e){e.elements.forEach(function(e){if(e.question){var i=e.question;t&&(i={},angular.copy(e.question,i)),r.push(i)}})}),r},e.getQuestionWithResponseList=function(t,r){var i=[];return e.getQuestionList(t,!0).forEach(function(t){var n=r[t.id];n?t.response=e.extractResponse(t,n):t.response=null,i.push(t)}),i},e.$$getHeader=function(e,t,r,i,n){var o="";return n&&((e||0===e)&&(o+=e+"."),(r||0===r)&&(o+=r+"."),o.length&&(o+=" ")),o+=t,i&&(o+=" ["+i+"]"),o},e.getResponseSheetHeaders=function(t,r){var i=[],n=0;return e.getQuestionList(t).forEach(function(t){n++;var o=1;if("text"==t.type||"textarea"==t.type||"radio"==t.type||"checkbox"==t.type)i.push(e.$$getHeader(n,t.text,null,null,r));else if("grid"==t.type){if(!t.grid)return;t.grid.rows.forEach(function(s){i.push(e.$$getHeader(n,t.text,o,s.label,r)),o++})}else if("priority"==t.type){if(!t.priorityList)return;t.priorityList.forEach(function(s){i.push(e.$$getHeader(n,t.text,o,s.value,r)),o++})}else if("division"==t.type){if(!t.divisionList)return;t.divisionList.forEach(function(s){i.push(e.$$getHeader(n,t.text,o,s.value,r)),o++})}}),i},e.getResponseSheetRow=function(t,r){var i="; ",n=[];if(!r)return n;for(var o=e.getQuestionWithResponseList(t,r),s=0;s<o.length;s++){var u=o[s],a=u.response;if("text"==u.type||"textarea"==u.type)n.push(a?a:"");else if("radio"==u.type){if(!a){n.push("");continue}var c="";a.selectedAnswer&&(c=a.selectedAnswer.value),a.other&&(c&&(c+=i),c+=a.other),n.push(c)}else if("checkbox"==u.type){if(!a||!a.selectedAnswers){n.push("");continue}var c="";a.selectedAnswers.forEach(function(e){c&&(c+=i),c+=e.value}),a.other&&(c&&(c+=i),c+=a.other),n.push(c)}else if("grid"==u.type){if(!u.grid)continue;if(!a){u.grid.rows.forEach(function(){n.push("")});continue}a.forEach(function(e){n.push(e.col?e.col.label:"")})}else if("priority"==u.type){if(!u.priorityList)continue;var p=e.$getObjectByIdMap(a);u.priorityList.forEach(function(e){var t=p[e.id];t?n.push(t.priority):n.push("")})}else if("division"==u.type){if(!u.divisionList)continue;var f=e.$getObjectByIdMap(a);u.divisionList.forEach(function(e){var t=f[e.id];t?n.push(t.value):n.push("")})}}return n},e.getResponseSheetRows=function(t,r){return r.map(function(r){return e.getResponseSheetRow(t,r)})},e.getResponseSheet=function(t,r,i){var n=[],o=e.getResponseSheetHeaders(t,i);return n.push(o),r?(r instanceof Array?r.forEach(function(r){n.push(e.getResponseSheetRow(t,r))}):n.push(e.getResponseSheetRow(t,r)),n):n},e});